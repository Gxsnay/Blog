# `JS` - ä»£ç è´¨é‡

> ä»£ç è´¨é‡ä¸å…¶æ•´æ´åº¦æˆæ­£æ¯”ã€‚å¹²å‡€çš„ä»£ç ï¼Œæ—¢åœ¨è´¨é‡ä¸Šè¾ƒä¸ºå¯é ï¼Œä¹Ÿä¸ºåæœŸç»´æŠ¤ã€å‡çº§å¥ å®šäº†è‰¯å¥½åŸºç¡€ã€‚

## æµ‹è¯•

**æµ‹è¯•æ˜¯ä¸€ç§éªŒè¯æˆ‘ä»¬çš„ä»£ç æ˜¯å¦å¯ä»¥æŒ‰é¢„æœŸå·¥ä½œçš„æ–¹æ³•ã€‚**

å•å…ƒæµ‹è¯•æ˜¯æŒ‡**å¯¹è½¯ä»¶ä¸­æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚**

> **åˆ¤æ–­æŸä¸ªç‰¹å®šæ¡ä»¶æˆ–è€…æŸä¸ªç‰¹å®šåœºæ™¯ä¸‹çš„ä¸€ä¸ªç‰¹å®šè¡Œä¸ºè¿›è¡Œçš„æµ‹è¯•å·¥ä½œã€‚**

è¢«æµ‹è¯•çš„å¯¹è±¡ï¼Œå¯ä»¥æ˜¯**æ ·å¼ / åŠŸèƒ½ / æµç¨‹ / ç»„ä»¶ç­‰ã€‚**

### æ„ä¹‰

- æ£€æµ‹å‡ºæ½œåœ¨çš„`bug`ã€‚
- å¿«é€Ÿåé¦ˆåŠŸèƒ½è¾“å‡ºï¼ŒéªŒè¯ä»£ç æ˜¯å¦è¾¾åˆ°é¢„æœŸã€‚
- ä¿è¯ä»£ç é‡æ„çš„å®‰å…¨æ€§ã€‚
- æ–¹ä¾¿åä½œå¼€å‘ã€‚

### å•å…ƒæµ‹è¯•ä»£ç 

> è¢«æµ‹è¯•å¯¹è±¡ `<=>` æµ‹è¯•ä»£ç 

**è¢«æµ‹è¯•å¯¹è±¡ä¸ºç¨‹åºä¸­çš„æœ€å°ç»„æˆå•å…ƒ(å‡½æ•°ã€åŠŸèƒ½ç­‰ç­‰)ï¼Œå¯ä»¥åšåˆ°å­¤ç«‹çš„éªŒè¯ã€‚**

```js
let add = (a, b) => a + b;
let subtraction = (a, b) => a - b;

// æµ‹è¯•ä»£ç 
let expect = (res) => {
  // res å®é™…å€¼
  return {
    toBe: (actual) => {
      // actual æœŸæœ›å€¼
      if (res !== actual) {
        throw new Error("é¢„æœŸå€¼ ä¸ å®é™…å€¼ ä¸ç¬¦");
      }
    },
  };
};
expect(add(1, 2)).toBe(3); // æµ‹è¯•é€šè¿‡ ä¸æ‰“å°
// expect(add(1, 2)).toBe(2); // Uncaught Error: é¢„æœŸå€¼ ä¸ å®é™…å€¼ ä¸ç¬¦
```

```js
let test = (desc, fn) => {
  try {
    fn();
  } catch (e) {
    console.log(`${desc}æ²¡æœ‰é€šè¿‡ï¼Œå…·ä½“åŸå› ä¸º ${e}`);
  }
};
test("åŠ æ³•æµ‹è¯•", () => {
  expect(add(1, 2)).toBe(3); // æµ‹è¯•é€šè¿‡ ä¸æ‰“å°
  // expect(add(1, 2)).toBe(2); // åŠ æ³•æµ‹è¯•æ²¡æœ‰é€šè¿‡ï¼Œå…·ä½“åŸå› ä¸º Error: é¢„æœŸå€¼ ä¸ å®é™…å€¼ ä¸ç¬¦
});
```

### `Jest` çš„åŸºç¡€ä½¿ç”¨

>`npm i -D jest` æˆ–è€… `yarn add -D jest`ã€‚
>
>`npm ls jest` æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚[ å‡ºç°ç‰ˆæœ¬å·åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ ]

```js
// math.js
let add = (a, b) => a + b;
module.exports = { add };
// math.test.js
const { add } = require('./math');
test('åŠ æ³•æµ‹è¯•', () => {
  exprct(add(1, 2).toBe(3));
})
// package.json
"script": {
  test: "jest",
}
// npm run test - å°±ä¼šæœ‰æ‰“å°
```

1. åˆ›å»ºè¢«æµ‹è¯•å¯¹è±¡`math.js`ã€‚
2. åˆ›å»º`test`æ–‡ä»¶ `math.test.js`ã€‚
3. ä¿®æ”¹ `package.json` æ–‡ä»¶ã€‚
4. æ‰§è¡Œ`npm test`ã€‚

> åªæœ‰æ›´å¥½çš„å®Œæˆå•å…ƒæµ‹è¯•ï¼Œæ‰èƒ½æ›´å¥½çš„å®Œæˆ **é›†æˆæµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•** ç­‰ç­‰ã€‚

```js
// è¢«æµ‹è¯•å¯¹è±¡
let add = (a, b) => a + b;

// æµ‹è¯•ä»£ç 
let expect = (res) => {
  return {
    toBe: (actual) => {
      if (res !== actual) {
        throw new Error("æœŸæœ›å€¼ä¸é¢„æœŸå€¼ä¸ç¬¦");
      }
    },
  };
};
```

## å¯é æ€§

### å‡½æ•°å¼ç¼–ç¨‹

**å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ˜¯ä¸€ç§æ„å»ºè®¡ç®—æœºç¨‹åºç»“æ„å’Œå…ƒç´ çš„é£æ ¼ï¼Œå®ƒæŠŠè®¡ç®—çœ‹ä½œæ˜¯å¯¹æ•°å­¦å‡½æ•°çš„è¯„ä¼°ï¼Œé¿å…äº†çŠ¶æ€çš„å˜åŒ–å’Œæ•°æ®çš„å¯å˜ã€‚**

+ ç»™æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹+1

  ```js
  // bad
  let arr = [1, 2, 3, 4];
  let newArr = [];
  for (let i = 0; i < arr.length; i++) {
    newArr.push(arr[i] + 1);
  }
  console.log(newArr); // [2, 3, 4, 5]
  
  // bad...
  let newArr = (arr) => {
    let res = [];
    for (let i = 0; i < arr.length; i++) {
      res.push(arr[i] + 1);
    }
    return res;
  };
  console.log(newArr); // [2, 3, 4, 5]
  ```

  **ğŸ‘† ä»¥ä¸Šçš„éƒ½å¯ä»¥è¢«ç§°ä¸º å‘½ä»¤å¼ç¼–ç¨‹ã€‚**

  å‘½ä»¤å¼ç¼–ç¨‹ï¼š **è¯¦ç»†çš„å‘½ä»¤æœºå™¨æ€ä¹ˆå»å¤„ç†ä¸€ä»¶äº‹æƒ…ä»¥è¾¾åˆ°ä½ æƒ³è¦çš„ç»“æœã€‚**

  ```js
  // good
  let newArr = (arr, fn) => {
    let res = [];
    for (let i = 0; i < arr.length; i++) {
      res.push(fn(arr[i]));
    }
    return res;
  };
  let add = (item) => item + 5;
  let sum = newArr(arr, add); // [6, 7, 8, 9];
  ```

  **ğŸ‘† ä»¥ä¸Šçš„éƒ½å¯ä»¥è¢«ç§°ä¸º å‡½æ•°å¼ç¼–ç¨‹ã€‚**

  å‡½æ•°å¼ç¼–ç¨‹ï¼š ä¸»å¼ **å°†å¤æ‚çš„å‡½æ•°ç»„åˆæˆç®€å•çš„å‡½æ•°ï¼Œå°†è¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—çš„ å‡½æ•°è°ƒç”¨ã€‚**

  **å½“æˆ‘ä»¬å†å»å°†æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œé€»è¾‘å¤„ç†çš„æ—¶å€™ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä¸ªé€»è¾‘å‡½æ•°å³å¯ã€‚**

+ **å‡½æ•°å¼ç¼–ç¨‹ ğŸ“**

  **å°†æˆ‘ä»¬ç¨‹åºåˆ†è§£ä¸ºä¸€äº›å¯é‡ç”¨ï¼Œæ›´å¯é ä¸”æ›´æ˜“äºç†è§£çš„éƒ¨åˆ†ï¼Œç„¶åå†å°†ä»–ä»¬ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ›´æ˜“æ¨ç†çš„ç¨‹åºæ•´ä½“ã€‚**

  **æˆ‘ä»¬å°†ä¸€ä¸ªä»»åŠ¡ æ‹†åˆ†æˆ å¤šä¸ªæœ€å°é¢—ç²’çš„å‡½æ•°ï¼Œç„¶åé€šè¿‡ç»„åˆçš„æ–¹å¼æ¥å®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ã€‚ å’Œç»„ä»¶åŒ–ç±»ä¼¼~**

  æˆ‘ä»¬å°± åªéœ€å®Œæˆæˆ‘ä»¬æƒ³è¦å®Œæˆçš„åŠŸèƒ½ä»£ç å³å¯ï¼Œæ— éœ€å»å…³å¿ƒå…¶ä»–å†…éƒ¨çš„å®ç°ã€‚

### çº¯å‡½æ•°

**å¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœï¼Œä»–ä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚**

```js
let discount = 0.8;
const calcuatePrice = (price) => price * discount;
let price = calcuatePrice(200);
console.log(price);
```

ğŸ‘† ä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•° âš ï¸ï¼Œæ˜¯å› ä¸ºä½¿ç”¨äº†**æ²¡æœ‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°çš„å˜é‡ã€‚**

> `discount`æ˜¯**å¤–éƒ¨è·å–ï¼Œä¸èƒ½ä¿è¯ç›¸åŒè¾“å‡ºã€‚**

```js
const calcuatePrice = (price, discount) => price * discount;
let price = calcuatePrice(200 * 0.8);
console.log(price);
```

ğŸ‘† å°±æ˜¯çº¯å‡½æ•° ğŸ“ - **ç›¸åŒçš„è¾“å…¥æ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚**

è™½ç„¶æ²¡æœ‰å¿…è¦æ‰€æœ‰å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°ï¼Œ ä½†æ˜¯æˆ‘ä»¬**å¯ä»¥ç”¨çº¯å‡½æ•°æ¥å¤„ç†æ‹¼æ¥å‡½æ•°**ï¼Œä»¥æ­¤æ¥å‡å°‘ éçº¯å‡½æ•° çš„æ•°é‡ã€‚

- **å‡½æ•°å‰¯ä½œç”¨**

  > **çº¯å‡½æ•°æ²¡æœ‰å‰¯ä½œç”¨**

  - **å½“è°ƒç”¨å‡½æ•°æ—¶ï¼Œé™¤äº†è¿”å›å‡½æ•°å€¼ä¹‹å¤–ï¼Œè¿˜å¯¹ä¸»è°ƒç”¨å‡½æ•°äº§ç”Ÿé™„åŠ çš„å½±å“ã€‚**

    ä¾‹å¦‚ï¼šä¿®æ”¹å…¨å±€å˜é‡ï¼ˆå‡½æ•°å¤–çš„å˜é‡ï¼‰ æˆ–è€… ä¿®æ”¹å‚æ•°ã€‚

    **ä¸¥æ ¼çš„å‡½æ•°å¼è¯­è¨€è¦æ±‚ å‡½æ•°å¿…é¡»æ²¡æœ‰å‰¯ä½œç”¨**ï¼Œä½†æ˜¯åœ¨é¢å‘å¯¹è±¡ä¸­ï¼Œå¯å˜å’Œå‰¯ä½œç”¨å°±å¾ˆå¸¸è§ã€‚

  ```js
  let a = 5;
  let foo = () => (a = a * 5);
  foo();
  console.log(a); // 50
  // ğŸ‘† é™¤äº†è°ƒç”¨å¤–éƒ¨å˜é‡ä»¥å¤–ï¼Œè¿˜ä¿®æ”¹äº†å¤–éƒ¨å˜é‡ï¼Œè¿™ä¸ªå°±æ˜¯ å‡½æ•°å‰¯ä½œç”¨~
  
  let arr = [1, 2, 3, 4, 5, 6];
  arr.slice(1, 3); // çº¯å‡½æ•° è¿”å› [2, 3] åŸæ•°ç»„ä¸å˜~ ğŸ“
  arr.splice(1, 3); // éçº¯å‡½æ•°ï¼Œ è¿”å› [2, 3, 4] åŸæ•°ç»„æ”¹å˜ âš ï¸
  arr.pop(); // éçº¯å‡½æ•°ï¼Œè¿”å› 6ï¼ŒåŸæ•°ç»„æ”¹å˜ âš ï¸
  ```

**ç¼–å†™å‡ºæ²¡æœ‰å‰¯ä½œç”¨çš„ç¨‹åºæ˜¯ä¸å¯èƒ½çš„ï¼Œè€Œä¸”æœ‰çš„ç¨‹åºå‰¯ä½œç”¨æ˜¯ä¸å¯é¿å…çš„ã€‚**

æ‰€ä»¥æˆ‘ä»¬åªè¦ **å°½å¯èƒ½çš„å‡å°‘å‡½æ•°å‰¯ä½œç”¨ã€‚**

### ä¸çº¯çš„å‡½æ•°

```js
const foo = (something) => {
  const dt = new Date().toISOString();
  console.log(`${dt}:${something}`);
  return something;
};
foo("hello");
// è¿èƒŒäº† ç›¸åŒçš„è¾“å…¥æ€»æ˜¯ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºåŸåˆ™~
```

- **ä¾èµ–æ³¨å…¥ è¿›è¡Œæ”¹è¿›**

  ```js
  const foo = (d, log, something) => {
    const dt = d.toISOString();
    return log(`${dt}:${something}`);
  };
  const something = "ä½ å¥½";
  const d = new Date();
  const log = console.log.bind(console);
  foo(d, log, something);
  ```

  > ä¸çº¯çš„éƒ¨åˆ†æå–å‡ºæ¥ï¼Œä¸çº¯çš„ä»£ç  è¿œç¦» æ ¸å¿ƒä»£ç ã€‚
  >
  > `foo` å‡½æ•° å˜çº¯äº†...

**æŠŠä¸ç¡®å®šæ€§å°½é‡å‡åˆ°æœ€å°ï¼Œå°†å…¶ä¿å­˜èµ·æ¥ï¼Œè¿›è¡Œé›†ä¸­ç®¡ç†ã€‚**

- **ä¿è¯å‡½æ•°æ— å‰¯ä½œç”¨çš„ç‰¹æ€§ ğŸ“**
  - **å‡½æ•°å…¥å£ä½¿ç”¨å‚æ•°è¿ç®—ï¼Œè€Œä¸ä¿®æ”¹å®ƒã€‚**
  - **å‡½æ•°å†… ä¸ä¿®æ”¹ å‡½æ•°å¤–çš„å˜é‡ã€‚**
  - **è®¡ç®—ç»“æœé€šè¿‡å‡½æ•°è¿”å›ç»™å¤–éƒ¨ã€‚**

### å¯å˜æ€§ & ä¸å¯å˜æ€§

**å¯å˜æ€§ï¼Œæ˜¯æŒ‡ä¸€ä¸ªå˜é‡åˆ›å»ºä»¥åå¯ä»¥ä»»æ„ä¿®æ”¹ã€‚**

ä¸å¯å˜æ€§ æ˜¯æŒ‡ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±æ°¸è¿œä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œ**ä¸å¯å˜æ€§æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µã€‚**å› ä¸ºæ²¡æœ‰å®ƒï¼Œç¨‹åºä¸­çš„æ•°æ®æµæ˜¯æœ‰æŸçš„ã€‚

```js
let data = { count: 1 };
let foo = (data) => {
  data.count = 3;
};
console.log(data.count); // 1
// è°ƒç”¨ foo å‡½æ•°
foo(data);
console.log(data.count); // 3
```

- **`JS`ä¸­æ²¡æœ‰åŸç”Ÿçš„ä¸å¯å˜æ€§**

  **å¯ä»¥é€šè¿‡æ·±æ‹·è´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚**

  ```js
  let data = { count: 1 };
  let foo = (data) => {
    // æ·±æ‹·è´
    // let lily = { ...data }; // æ‰©å±•è¿ç®—ç¬¦ - åªèƒ½å¯¹ ç¬¬ä¸€å±‚çº§ è¿›è¡Œæ·±æ‹·è´~
    let lily = JSON.parse(JSON.stringify(data)); // JSON - å¯¹å¤šä¸ªå±‚çº§è¿›è¡Œæ·±æ‹·è´~ ä¹Ÿæ˜¯æ•°æ®çš„ä¸å¯å˜æ€§~
    lily.count = 3;
  };
  console.log(data.count); // 1
  // è°ƒç”¨ foo å‡½æ•°
  foo(data);
  console.log(data.count); // 1
  // è¿™æ ·å°±ä¿è¯äº† æ•°æ®çš„ä¸å¯å˜æ€§ ğŸ“
  ```

